{ 
    "$addFields": { 
      "cdsid": { 
        "$ifNull": [
          { "$cond": [ { "$eq": ["$delta.input.name", "cdsid"] }, "$delta.input.value", null ] },
          { "$cond": [ { "$eq": ["$snapshot.input.name", "cdsid"] }, "$snapshot.input.value", null ] }
        ]
      },
      "mpsid": { 
        "$ifNull": [
          { "$cond": [ { "$eq": ["$delta.input.name", "mpsid"] }, "$delta.input.value", null ] },
          { "$cond": [ { "$eq": ["$snapshot.input.name", "mpsid"] }, "$snapshot.input.value", null ] }
        ]
      }
    } 
  }
